

title:他のwebサイトの要素を埋め込むときにセキュリティ的に気をつけなければならないこと

description:次の4つの選択肢で最もまずいものは?1. あるWeb サイトから配信されるHTML において、img 要素で他のWeb サイトの画像を埋め込んでいる。2. ある Web サイトから配信されるHTML において、iframe 要素で他のWeb サイトのHTML を埋め込んでいる。 

img:https://cybersecurity-jp.com/wp-content/uploads/2016/01/img_6935-01.png





##次の4つの選択肢で最もまずいものは?

1. あるWeb サイトから配信されるHTML において、img 要素で他のWeb サイトの画像を埋め込
んでいる。

2. ある Web サイトから配信されるHTML において、iframe 要素で他のWeb サイトのHTML を
埋め込んでいる。 

3. あるWeb サイトから配信されるJavaScript プログラムにおいて、他のWeb サイトのHTML を
取得し、読み込んでいる。

4. あるWeb サイトから配信されるHTML 内の script 
要素で定義されたJavaScript プログラムに
おいて、iframe 要素で埋め込まれた他のWebサイトのHTML を読み込んでいる。



<a href="https://www.amazon.co.jp/%E8%A9%B3%E8%A7%A3%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%B3%E3%83%B3%E3%83%86%E3%82%B9%E3%83%88-%E6%A2%85%E5%86%85%E7%BF%BC-ebook/dp/B094J7ZCJN/ref=sr_1_2?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&dchild=1&keywords=CTF&qid=1635043389&s=books&sr=1-2">
引用元：詳解セキュリティコンテスト
</a>



##ある Web サイトから配信されるHTML において、iframe 要素で他のWeb サイトのHTML を埋め込んでいる。 

問題なし。

当ブログも他のサイトのURLを利用している。

(サイトの運営上、画像検索に引っ掛からなくなるという致命的な問題点はあるが)



##ある Web サイトから配信されるHTML において、iframe 要素で他のWeb サイトのHTML を埋め込んでいる。 

例えば、ECショッピングのサイトでのクレジットカードを含んだログイン済み画面が存在するとして、iframeで埋め込んだ場合。

この場合はiframeで埋め込んでも何も表示されません。

基本的にはECショッピングのサイトの内容は他のサイトのiframeから観測できないようにセキュリティとしてガードできているからです。

また、ECサイトでは正当なブラウザと秘密に共有しているセッション情報と呼ばれる情報を保持しており、ログインした状態は別のブラウザから観測した瞬間に無効になるからです。


###しかしながらiframeでページを埋め込むことはクリックジャッキングという別の問題を引き起こすことになる

<img src="https://cybersecurity-jp.com/wp-content/uploads/2016/01/img_6935-01.png">







##あるWeb サイトから配信されるJavaScript プログラムにおいて、他のWeb サイトのHTML を取得し、読み込んでいる。

結論からいうと、このプログラムでは盗聴できてしまう可能性があります。


<a href="https://www.amazon.co.jp/%E8%A9%B3%E8%A7%A3%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%B3%E3%83%B3%E3%83%86%E3%82%B9%E3%83%88-%E6%A2%85%E5%86%85%E7%BF%BC-ebook/dp/B094J7ZCJN/ref=sr_1_2?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&dchild=1&keywords=CTF&qid=1635043389&s=books&sr=1-2">
引用元：詳解セキュリティコンテスト
</a>


<pre><code>
この場合、もしJavaScript プログラムから Fetch API等 を利用して取得したドキュメントに機密情報が含まれていた場合
、攻撃者はその情報を観測する ことができます。

攻撃者は、前述の location や Fetch APIを利用し、自身が管理する Webサー バーに対して、DOM API を介して取得した機密情報を含む 
HTML の情報(例:document.body) を送信すればよいのです。
</code></pre>

考えられる具体的な手順は以下の通り

1,被害者がECサイトにログインする

2,そのECサイトにログインした状態のまま、別のタブを開き攻撃者のサーバーにログインする

3,攻撃者のサーバーでは1でのセッション情報を使ってECサイトにjavascriptを使ったログインを行い、機密情報を盗み取ることができる






##あるWeb サイトから配信されるHTML 内の script要素で定義されたJavaScript プログラムにおいて、iframe 要素で埋め込まれた他のWebサイトのHTMLを読み込んでいる。

言い換えると

###攻撃者のサーバーから配信されるHTML内のjavascriptでiframe要素で埋め込まれた他のWebサイトのHTMLを読み込んでいる。

先程の章()が問題があると考えればこれも問題があるとわかる。

<pre>
2つの違いは
JavaScript プログラムによって能動的に 取得しているか、
もしくはそのドキュメントをiframeとして埋め込むことでWebブラウザに取得させているかだけです
</pre>




