

title:データ型とその変換について【SQL】

description:




## 暗黙的な型変換

暗黙的な型変換とは、SQL側の忖度である。

通常プログラミングにおいて二つ以上のデータの比較、代入等が発生した場合、その二つが異なるデータ型であればエラーとなってしまう。

<pre><code>
例）
select max(to_date("2021-01-14") , 10) from dual
>　これはエラーになる
</code></pre>

しかし、ある特定の異なるデータ方の代入、比較、演算においてはエラーが出ない

<pre><code>
例）
select to_date("2021-01-01") + 1  from dual
> 2021-01-02
</code></pre>

これは

###SQLというプログラミング言語が忖度を行い、ユーザーの意向を取り計らってくれるからである。

これを

### 暗黙的な型変換

と呼ぶ




## 暗黙的な型変換が失敗するケース

### 暗黙的な型変換は、変換データが意味を持たない場合に失敗する

例えば次のコードはエラーが発生する

<pre><code>
select
    *
FROM
    employees e
where
    e.birthday > '1998-90-90'
</code></pre>

理由は、'1998-90-90'を日付に変更しようにも、90月という月も、90日という月も存在しないためである。

よって、次のクエリは実行が可能

<pre><code>
select
    *
FROM
    employees e
where
    e.birthday > '1998-01-01'
</code></pre>



## 明示的な型変換

to_char, to_dateは明示的な型変換を行う関数である。

これはJavaやpythonなどでの"キャスト"に値する

型変換を行う関数は全部で3つ

- to_char

- to_date

- to_number

※日付を数値に、数値を日付に変換する関数は存在しない



## 日付から文字列を取り出す

to_char関数は日付から好きな形で文字列を取り出すことができます。

例えば次のSQL

<pre><code>
select
    sysdate,
    to_char(sysdate, "YYYY/MM/DD HH12:MI:SS")
from dual

> 2021-01-01 14:01:01,
> 2021/01/01 02:01:01

</code></pre>

ここで

YYYY : 4桁で「西暦何年」を取り出す

MM : 「何月」を取り出す

DD : 「何日」を取り出す

HH12 : 1-12の形式で時間を取り出す

HH24 : 1-24の形式で時間を取り出す

MI : 「何分」を取り出す

" some string " : 二重引用符は好きな文字列を入れられる。

を示す。

また、-や(, : などの半角記号はそのまま表示される


## 数値から文字列への変更

数値から文字列への変更もTO_char関数で可能












